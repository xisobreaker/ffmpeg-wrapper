#!/bin/bash

# 定义允许的提交类型
readonly COMMENT_TYPES=(
    "feat:" 
    "fix:" 
    "docs:" 
    "style:" 
    "refactor:" 
    "test:" 
    "chore:"
)

# 检查是否提供了提交信息文件作为参数
if [ -z "$1" ]; then
    echo "Usage: $0 <commit_message_file>"
    exit 1
fi

# 读取提交信息文件
COMMIT_MSG_FILE="$1"
if [ ! -f "$COMMIT_MSG_FILE" ]; then
    echo "Error: File '$COMMIT_MSG_FILE' does not exist."
    exit 1
fi
commit_msg=$(<"$COMMIT_MSG_FILE")

# 检查提交信息是否以允许的类型之一开头
is_valid=false
for type in "${COMMENT_TYPES[@]}"; do
    if [[ "$commit_msg" == $type* ]]; then
        is_valid=true
        break
    fi
done

# 如果提交信息不符合规范，则打印错误并退出
if ! $is_valid; then
    echo "Error: Commit message must start with one of the following types:"
    for type in "${COMMENT_TYPES[@]}"; do
        echo "  $type"
    done
    exit 1
fi

echo "Commit message is valid."
exit 0
